<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulaci√≥n de N√∫cleos At√≥micos - Rust + WebAssembly</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            flex-direction: column;
            background: #0a0a0a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .controls {
            background: rgba(0, 0, 0, 0.95);
            padding: 15px;
            border-radius: 0;
            border-bottom: 2px solid #333;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-start;
            max-height: 400px;
            overflow-x: auto;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .controls-section {
            display: flex;
            flex-direction: column;
            min-width: 150px;
            max-width: 250px;
            flex-shrink: 0;
        }

        .controls h3 {
            color: #4CAF50;
            margin: 0 0 4px 0;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
        }

        .controls h4 {
            color: #2196F3;
            margin: 6px 0 4px 0;
            font-size: 11px;
            font-weight: bold;
        }

        button {
            padding: 8px 12px;
            margin: 3px 0;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            transition: background 0.2s;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: 80px;
        }

        button:hover {
            background: #45a049;
        }

        .particle-btn {
            background: #2196F3;
            padding: 6px 10px;
            font-size: 11px;
            min-width: 70px;
        }

        .particle-btn:hover {
            background: #1976D2;
        }

        .clear-btn {
            background: #f44336;
            padding: 8px 12px;
            font-size: 12px;
        }

        .clear-btn:hover {
            background: #d32f2f;
        }

        .control-group {
            margin: 4px 0;
        }

        .control-group label {
            display: block;
            margin-bottom: 2px;
            font-size: 10px;
            color: #ccc;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 4px;
            background: #333;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .control-group input[type="range"]:hover {
            opacity: 1;
        }

        .value-display {
            color: #4CAF50;
            font-weight: bold;
            font-size: 10px;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .controls-sidebar {
            width: 250px;
            background: rgba(0, 0, 0, 0.95);
            padding: 15px;
            border-right: 2px solid #333;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
        }

        .controls-sidebar h3 {
            color: #4CAF50;
            margin: 0 0 15px 0;
            font-size: 16px;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 5px;
        }

        .controls-sidebar h4 {
            color: #2196F3;
            margin: 15px 0 8px 0;
            font-size: 12px;
        }

        .controls-sidebar .controls-section {
            margin-bottom: 15px;
        }

        .controls-sidebar .control-group {
            margin: 8px 0;
        }

        .controls-sidebar .control-group label {
            display: block;
            margin-bottom: 4px;
            color: #fff;
            font-size: 11px;
        }

        .controls-sidebar input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .canvas-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            margin: 0;
            height: 100vh;
            background: #000;
        }

        .info-sidebar {
            width: 210px; /* Reducido 30% desde 300px */
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-left: 2px solid #333;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .controls h4 {
            color: #2196F3;
            margin: 10px 0 8px 0;
            font-size: 14px;
        }

        .controls-section {
            border-top: 1px solid #444;
            padding: 8px 0;
            margin: 5px 0;
        }

        .controls-section:first-child {
            border-top: none;
        }

        button {
            padding: 10px 15px;
            margin: 4px 0;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            width: 100%;
            transition: background 0.3s;
        }

        button:hover {
            background: #45a049;
        }

        .particle-btn {
            background: #2196F3;
        }

        .particle-btn:hover {
            background: #0b7dda;
        }

        .clear-btn {
            background: #f44336;
        }

        .clear-btn:hover {
            background: #da190b;
        }

        .control-group {
            margin: 8px 0;
            color: #ccc;
            font-size: 12px;
        }

        .control-group label {
            display: block;
            margin-bottom: 4px;
            color: #fff;
        }

        .control-group input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .value-display {
            color: #4CAF50;
            font-weight: bold;
            float: right;
        }

        .element-info {
            background: rgba(0, 0, 0, 0.9);
            color: #4CAF50;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            border: 2px solid #4CAF50;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .element-info h3 {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .element-info ul {
            list-style: none;
        }

        .element-info li {
            padding: 3px 0;
        }

        .color-legend {
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            border: 2px solid #2196f3;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .color-legend h3 {
            color: #2196f3;
            margin-bottom: 12px;
            font-size: 14px;
            text-align: center;
            font-weight: bold;
        }

        .legend-section {
            margin-bottom: 15px;
        }

        .legend-section h4 {
            color: #4CAF50;
            margin-bottom: 8px;
            font-size: 11px;
            font-weight: 600;
            border-bottom: 1px solid #333;
            padding-bottom: 3px;
        }

        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 2px 0;
        }

        .color-box {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            flex-shrink: 0;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        canvas {
            border: 3px solid #333;
            background: #000;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            display: block;
        }

        
        #status {
            color: #4CAF50;
            font-weight: bold;
            text-align: center;
        }

        .loading {
            color: #2196F3;
            text-align: center;
            padding: 20px;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        ::-webkit-scrollbar-thumb {
            background: #4CAF50;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #45a049;
        }

        .periodic-table {
            display: grid;
            grid-template-columns: repeat(18, 1fr);
            gap: 2px;
            margin: 8px 0;
            font-size: 9px;
        }

        .element-btn {
            padding: 3px 2px;
            font-size: 8px;
            background: #666;
            min-height: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .element-btn:hover {
            background: #4CAF50;
            transform: scale(1.1);
        }

        .element-btn .symbol {
            font-weight: bold;
            font-size: 10px;
        }

        .element-btn .number {
            font-size: 6px;
            opacity: 0.7;
        }

        /* Special positioning for Lanthanides and Actinides */
        .lanthanide-series, .actinide-series {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            gap: 2px;
            margin: 4px 0;
        }
    </style>
    <script type="module">
        let engine = null;
        let canvas = null;
        let ctx = null;
        let animationId = null;
        let isRunning = false;
        let lastFrameTime = 0;
        let frameCount = 0;
        let fps = 0;
        let fpsUpdateTime = 0;
        let animationSpeed = 1; // 0.1 = lento, 20.0 = m√°ximo FPS
        let physicsUpdateCounter = 0; // Contador separado para f√≠sica

        async function initWasm() {
            try {
                console.log('üöÄ Iniciando carga de WebAssembly...');

                // Verificar si estamos en Vercel o local
                const isVercel = window.location.hostname.includes('vercel.app');
                console.log('üåê Entorno:', isVercel ? 'Vercel' : 'Local');

                // Verificar disponibilidad de archivos WebAssembly
                console.log('üîç Verificando archivos WebAssembly...');
                try {
                    const response = await fetch('./pkg/atomic_particles_simulation_bg.wasm');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    console.log('‚úÖ Archivo .wasm accesible');
                } catch (error) {
                    console.error('‚ùå Error accediendo al archivo .wasm:', error);
                    throw error;
                }

                // Usar la inicializaci√≥n est√°ndar de wasm-bindgen
                console.log('üì¶ Cargando m√≥dulo WebAssembly...');
                const moduleUrl = new URL('./pkg/atomic_particles_simulation.js', window.location.href).href;
                console.log('üîó URL del m√≥dulo:', moduleUrl);

                const { SimulationEngine, default: init } = await import(moduleUrl);
                console.log('‚úÖ M√≥dulo cargado exitosamente');

                // Inicializar el m√≥dulo WebAssembly
                console.log('üîß Inicializando WebAssembly...');
                await init();
                console.log('‚úÖ WebAssembly inicializado correctamente');

                canvas = document.getElementById('particleCanvas');
                ctx = canvas.getContext('2d');

                // Establecer dimensiones del canvas para que coincidan con su tama√±o mostrado
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;

                engine = new SimulationEngine(canvas.width, canvas.height);

                // Initial particles
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                engine.add_particle(centerX, centerY, 0);
                engine.add_particle(centerX + 50, centerY, 1);

                canvas.style.display = 'block';

                // Generar tabla peri√≥dica despu√©s de cargar todo
                console.log('Generando tabla peri√≥dica...');
                generatePeriodicTable();
                console.log('Tabla peri√≥dica generada');

                isRunning = true;
                animate();

            } catch (err) {
                document.getElementById('status').innerHTML = `‚ùå Error: ${err.message}`;
                document.getElementById('status').style.color = '#f44336';
                console.error('Error loading WASM:', err);
                console.error('Stack:', err.stack);
            }
        }

        function animate() {
            if (!isRunning || !engine) return;

            const currentTime = performance.now();

            // Calcular FPS
            frameCount++;
            if (currentTime - fpsUpdateTime >= 1000) { // Actualizar cada segundo
                fps = Math.round(frameCount * 1000 / (currentTime - fpsUpdateTime));
                document.getElementById('fpsDisplay').textContent = fps;
                frameCount = 0;
                fpsUpdateTime = currentTime;
            }

            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Para velocidades altas (>10x), usar m√∫ltiples actualizaciones por frame
            if (animationSpeed > 10) {
                const updatesPerFrame = Math.floor(animationSpeed / 10);
                for (let i = 0; i < updatesPerFrame; i++) {
                    engine.update();
                }
            } else {
                // Para velocidades normales, usar el contador continuo
                physicsUpdateCounter++;
                const updateFrequency = Math.max(1, Math.round(10 / animationSpeed));
                if (physicsUpdateCounter % updateFrequency === 0) {
                    engine.update();
                }
            }

            engine.render(ctx);
            updateInfo();

            // Para FPS altos, usar setTimeout en lugar de requestAnimationFrame
            if (animationSpeed > 5) {
                const targetInterval = Math.max(1, 1000 / (60 * animationSpeed / 5)); // Permitir hasta 5x la velocidad de RAF
                setTimeout(animate, targetInterval);
            } else {
                animationId = requestAnimationFrame(animate);
            }
        }

        function updateInfo() {
            if (!engine) return;

            const particleCount = engine.get_particle_count();
            let protons = 0, neutrons = 0, electrons = 0;

            for (let i = 0; i < particleCount; i++) {
                const dataStr = engine.get_particle_data(i);
                if (dataStr) {
                    const data = JSON.parse(dataStr);
                    switch (data.type) {
                        case 0: protons++; break;
                        case 1: neutrons++; break;
                        case 2: electrons++; break;
                    }
                }
            }

            document.getElementById('protonCount').textContent = protons;
            document.getElementById('neutronCount').textContent = neutrons;
            document.getElementById('electronCount').textContent = electrons;

            const nucleiData = engine.get_nuclei_data();
            const nuclei = JSON.parse(nucleiData);

            // Mostrar elementos qu√≠micos detectados con informaci√≥n de iones e is√≥topos
            const nucleiList = document.getElementById('nucleiList');
            nucleiList.innerHTML = '';

            if (nuclei.length > 0) {
                nuclei.forEach((nucleus, index) => {
                    const protonCount = nucleus.protons;
                    const neutronCount = nucleus.neutrons;
                    const electronCount = nucleus.electrons;
                    const elementSymbol = getElementSymbol(protonCount);

                    // Calcular carga i√≥nica
                    const charge = protonCount - electronCount;
                    let chargeSymbol = '';
                    if (charge > 0) {
                        chargeSymbol = charge === 1 ? '+' : charge + '+';
                    } else if (charge < 0) {
                        const absCharge = Math.abs(charge);
                        chargeSymbol = absCharge === 1 ? '-' : absCharge + '-';
                    }

                    // Determinar si es is√≥topo (neutrones diferentes al est√°ndar)
                    const standardNeutrons = getStandardNeutronCount(protonCount);
                    const isIsotope = neutronCount !== standardNeutrons;
                    const isotopeSymbol = isIsotope ? ` (${protonCount + neutronCount})` : '';

                    // Crear etiqueta descriptiva
                    let label = elementSymbol;
                    if (chargeSymbol) label += chargeSymbol; // Ion
                    if (isIsotope) label += isotopeSymbol;   // Is√≥topo

                    const li = document.createElement('li');
                    li.textContent = label;
                    nucleiList.appendChild(li);
                });
            } else {
                nucleiList.innerHTML = '<li>Ninguno</li>';
            }

            document.getElementById('nucleiCount').textContent = nuclei.length;
        }

        // Funci√≥n auxiliar para obtener s√≠mbolo del elemento
        function getElementSymbol(protonCount) {
            const symbols = {
                1: 'H', 2: 'He', 3: 'Li', 4: 'Be', 5: 'B', 6: 'C', 7: 'N', 8: 'O',
                9: 'F', 10: 'Ne', 11: 'Na', 12: 'Mg', 13: 'Al', 14: 'Si', 15: 'P',
                16: 'S', 17: 'Cl', 18: 'Ar', 19: 'K', 20: 'Ca', 21: 'Sc', 22: 'Ti',
                23: 'V', 24: 'Cr', 25: 'Mn', 26: 'Fe', 27: 'Co', 28: 'Ni', 29: 'Cu',
                30: 'Zn', 31: 'Ga', 32: 'Ge', 33: 'As', 34: 'Se', 35: 'Br', 36: 'Kr',
                37: 'Rb', 38: 'Sr', 39: 'Y', 40: 'Zr', 41: 'Nb', 42: 'Mo', 43: 'Tc',
                44: 'Ru', 45: 'Rh', 46: 'Pd', 47: 'Ag', 48: 'Cd', 49: 'In', 50: 'Sn',
                51: 'Sb', 52: 'Te', 53: 'I', 54: 'Xe', 55: 'Cs', 56: 'Ba', 57: 'La',
                58: 'Ce', 59: 'Pr', 60: 'Nd', 61: 'Pm', 62: 'Sm', 63: 'Eu', 64: 'Gd',
                65: 'Tb', 66: 'Dy', 67: 'Ho', 68: 'Er', 69: 'Tm', 70: 'Yb', 71: 'Lu',
                72: 'Hf', 73: 'Ta', 74: 'W', 75: 'Re', 76: 'Os', 77: 'Ir', 78: 'Pt',
                79: 'Au', 80: 'Hg', 81: 'Tl', 82: 'Pb', 83: 'Bi', 84: 'Po', 85: 'At',
                86: 'Rn', 87: 'Fr', 88: 'Ra', 89: 'Ac', 90: 'Th', 91: 'Pa', 92: 'U',
                93: 'Np', 94: 'Pu', 95: 'Am', 96: 'Cm', 97: 'Bk', 98: 'Cf', 99: 'Es',
                100: 'Fm', 101: 'Md', 102: 'No', 103: 'Lr', 104: 'Rf', 105: 'Db',
                106: 'Sg', 107: 'Bh', 108: 'Hs', 109: 'Mt', 110: 'Ds', 111: 'Rg',
                112: 'Cn', 113: 'Nh', 114: 'Fl', 115: 'Mc', 116: 'Lv', 117: 'Ts',
                118: 'Og'
            };
            return symbols[protonCount] || `E${protonCount}`;
        }

        // Funci√≥n auxiliar para obtener el n√∫mero est√°ndar de neutrones
        function getStandardNeutronCount(protonCount) {
            // Masa at√≥mica promedio aproximada (n√∫mero de nucleones)
            const standardMasses = {
                1: 1,   // H
                2: 4,   // He
                3: 7,   // Li
                4: 9,   // Be
                5: 11,  // B
                6: 12,  // C
                7: 14,  // N
                8: 16,  // O
                9: 19,  // F
                10: 20, // Ne
                11: 23, // Na
                12: 24, // Mg
                13: 27, // Al
                14: 28, // Si
                15: 31, // P
                16: 32, // S
                17: 35, // Cl
                18: 40, // Ar
                19: 39, // K
                20: 40, // Ca
                21: 45, // Sc
                22: 48, // Ti
                23: 51, // V
                24: 52, // Cr
                25: 55, // Mn
                26: 56, // Fe
                27: 59, // Co
                28: 59, // Ni
                29: 64, // Cu
                30: 65, // Zn
                31: 70, // Ga
                32: 73, // Ge
                33: 75, // As
                34: 79, // Se
                35: 80, // Br
                36: 84, // Kr
                37: 85, // Rb
                38: 88, // Sr
                39: 89, // Y
                40: 91, // Zr
                41: 93, // Nb
                42: 96, // Mo
                43: 98, // Tc
                44: 101, // Ru
                45: 103, // Rh
                46: 106, // Pd
                47: 108, // Ag
                48: 112, // Cd
                49: 115, // In
                50: 119, // Sn
                51: 122, // Sb
                52: 128, // Te
                53: 127, // I
                54: 131, // Xe
                55: 133, // Cs
                56: 137, // Ba
                57: 139, // La
                58: 140, // Ce
                59: 141, // Pr
                60: 144, // Nd
                61: 145, // Pm
                62: 150, // Sm
                63: 152, // Eu
                64: 157, // Gd
                65: 159, // Tb
                66: 163, // Dy
                67: 165, // Ho
                68: 167, // Er
                69: 169, // Tm
                70: 173, // Yb
                71: 175, // Lu
                72: 178, // Hf
                73: 181, // Ta
                74: 184, // W
                75: 187, // Re
                76: 191, // Os
                77: 193, // Ir
                78: 195, // Pt
                79: 197, // Au
                80: 201, // Hg
                81: 204, // Tl
                82: 207, // Pb
                83: 209, // Bi
                84: 209, // Po
                85: 210, // At
                86: 222, // Rn
                87: 223, // Fr
                88: 226, // Ra
                89: 227, // Ac
                90: 232, // Th
                91: 231, // Pa
                92: 238, // U
                93: 237, // Np
                94: 244, // Pu
                95: 243, // Am
                96: 247, // Cm
                97: 247, // Bk
                98: 251, // Cf
                99: 252, // Es
                100: 257, // Fm
                101: 258, // Md
                102: 259, // No
                103: 262, // Lr
                104: 267, // Rf
                105: 268, // Db
                106: 271, // Sg
                107: 272, // Bh
                108: 277, // Hs
                109: 276, // Mt
                110: 281, // Ds
                111: 282, // Rg
                112: 285, // Cn
                113: 286, // Nh
                114: 289, // Fl
                115: 290, // Mc
                116: 293, // Lv
                117: 294, // Ts
                118: 294  // Og
            };

            const totalNucleons = standardMasses[protonCount] || protonCount;
            return totalNucleons - protonCount;
        }

        window.addSingleParticle = function(type) {
            if (!engine) return;
            const x = Math.random() * (canvas.width - 40) + 20;
            const y = Math.random() * (canvas.height - 40) + 20;
            engine.add_particle(x, y, type);
        };

        window.addNucleus = function(protons, neutrons, electrons) {
            if (!engine) return;
            const x = Math.random() * (canvas.width - 200) + 100;
            const y = Math.random() * (canvas.height - 200) + 100;
            engine.add_nucleus(x, y, protons, neutrons, electrons);
        };

        window.clearCanvas = function() {
            if (!engine) return;
            engine.clear();
            updateInfo();
        };

        window.updateParam = function(paramName) {
            if (!engine) return;

            const valueMap = {
                'nuclear_force': 'nuclearForce',
                'nuclear_range': 'nuclearRange',
                'nuclear_attractive': 'nuclearAttractive',
                'nuclear_damping': 'nuclearDamping',
                'proton_repulsion': 'protonRepulsion',
                'coulomb_force': 'coulombForce',
                'orbital_speed': 'orbitalSpeed',
                'orbital_radius': 'orbitalRadius',
                'electron_repulsion': 'electronRepulsion',
                'nuclear_mass': 'nuclearMass',
                'electron_mass': 'electronMass',
                'electron_damping': 'electronDamping'
            };

            const inputId = valueMap[paramName];
            if (!inputId) return;

            const valueId = inputId + 'Value';
            const inputElement = document.getElementById(inputId);
            const valueElement = document.getElementById(valueId);

            if (inputElement && valueElement) {
                const value = parseFloat(inputElement.value);
                valueElement.textContent = value.toFixed(value < 1 ? 3 : 1);

                const methodName = 'set_' + paramName;
                if (typeof engine[methodName] === 'function') {
                    engine[methodName](value);
                }
            }
        };

        window.addHydrogenIons = function() {
            if (!engine) return;
            // H‚Å∫
            engine.add_nucleus(400, 300, 1, 0, 0);
            // H
            engine.add_nucleus(600, 300, 1, 0, 1);
            // H‚Åª
            engine.add_nucleus(800, 300, 1, 0, 2);
        };

        window.addElementAtom = function(atomicNumber, charge) {
            if (!engine) return;
            const element = periodicTable[atomicNumber];
            if (element) {
                const neutrons = atomicNumber === 1 ? 0 : Math.floor(atomicNumber * 1.5);
                const electrons = atomicNumber - charge;

                // Posici√≥n central del canvas
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;

                // Crear cada part√≠cula con velocidad inicial aleatoria
                const baseSpeed = 1.0; // Velocidad base

                // Crear protones con velocidad aleatoria
                for (let i = 0; i < atomicNumber; i++) {
                    const angle = Math.random() * 2 * Math.PI; // Direcci√≥n aleatoria
                    const speed = baseSpeed + Math.random() * baseSpeed; // Velocidad variable
                    const vx = Math.cos(angle) * speed;
                    const vy = Math.sin(angle) * speed;

                    const offsetX = (Math.random() - 0.5) * 20; // Peque√±a dispersi√≥n inicial
                    const offsetY = (Math.random() - 0.5) * 20;

                    engine.add_particle_with_velocity(
                        centerX + offsetX,
                        centerY + offsetY,
                        0, // Tipo: Prot√≥n
                        vx,
                        vy
                    );
                }

                // Crear neutrones con velocidad aleatoria
                for (let i = 0; i < neutrons; i++) {
                    const angle = Math.random() * 2 * Math.PI;
                    const speed = baseSpeed + Math.random() * baseSpeed;
                    const vx = Math.cos(angle) * speed;
                    const vy = Math.sin(angle) * speed;

                    const offsetX = (Math.random() - 0.5) * 20;
                    const offsetY = (Math.random() - 0.5) * 20;

                    engine.add_particle_with_velocity(
                        centerX + offsetX,
                        centerY + offsetY,
                        1, // Tipo: Neutr√≥n
                        vx,
                        vy
                    );
                }

                // Crear electrones con velocidad aleatoria
                for (let i = 0; i < electrons; i++) {
                    const angle = Math.random() * 2 * Math.PI;
                    const speed = baseSpeed * 0.5 + Math.random() * baseSpeed * 0.5; // Electrones m√°s lentos
                    const vx = Math.cos(angle) * speed;
                    const vy = Math.sin(angle) * speed;

                    const offsetX = (Math.random() - 0.5) * 30; // Mayor dispersi√≥n para electrones
                    const offsetY = (Math.random() - 0.5) * 30;

                    engine.add_particle_with_velocity(
                        centerX + offsetX,
                        centerY + offsetY,
                        2, // Tipo: Electr√≥n
                        vx,
                        vy
                    );
                }
            }
        };

        window.addElement = function(atomicNumber) {
            addElementAtom(atomicNumber, 0); // √Åtomo neutro por defecto
        };

        window.addCollisionPair = function(type1, type2) {
            if (!engine) return;

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const separation = 100;

            // Primera part√≠cula
            engine.add_particle_with_velocity(
                centerX - separation/2,
                centerY,
                type1,
                2.0,
                0
            );

            // Segunda part√≠cula
            engine.add_particle_with_velocity(
                centerX + separation/2,
                centerY,
                type2,
                -2.0,
                0
            );
        };

        window.saveConfiguration = function() {
            if (!engine) return;

            const config = {
                nuclearForce: document.getElementById('nuclearForce').value,
                nuclearRange: document.getElementById('nuclearRange').value,
                nuclearAttractive: document.getElementById('nuclearAttractive').value,
                nuclearDamping: document.getElementById('nuclearDamping').value,
                protonRepulsion: document.getElementById('protonRepulsion').value,
                coulombForce: document.getElementById('coulombForce').value,
                orbitalSpeed: document.getElementById('orbitalSpeed').value,
                orbitalRadius: document.getElementById('orbitalRadius').value,
                electronRepulsion: document.getElementById('electronRepulsion').value,
                nuclearMass: document.getElementById('nuclearMass').value,
                electronMass: document.getElementById('electronMass').value,
                electronDamping: document.getElementById('electronDamping').value
            };

            localStorage.setItem('simulationConfig', JSON.stringify(config));
            alert('Configuraci√≥n guardada exitosamente');
        };

        window.resetToDefaults = function() {
            if (!engine) return;

            // Resetear todos los sliders a valores por defecto
            document.getElementById('nuclearForce').value = 25;
            document.getElementById('nuclearRange').value = 40;
            document.getElementById('nuclearAttractive').value = 30;
            document.getElementById('nuclearDamping').value = 0.7;
            document.getElementById('protonRepulsion').value = 15;
            document.getElementById('coulombForce').value = 3;
            document.getElementById('orbitalSpeed').value = 8;
            document.getElementById('orbitalRadius').value = 100;
            document.getElementById('electronRepulsion').value = 2;
            document.getElementById('nuclearMass').value = 3;
            document.getElementById('electronMass').value = 0.01;
            document.getElementById('electronDamping').value = 0.999;

            // Actualizar display para todos los par√°metros
            updateParam('nuclear_force');
            updateParam('nuclear_range');
            updateParam('nuclear_attractive');
            updateParam('nuclear_damping');
            updateParam('proton_repulsion');
            updateParam('coulomb_force');
            updateParam('orbital_speed');
            updateParam('orbital_radius');
            updateParam('electron_repulsion');
            updateParam('nuclear_mass');
            updateParam('electron_mass');
            updateParam('electron_damping');

            alert('Configuraci√≥n restablecida a valores por defecto');
        };

        window.togglePause = function() {
            const pauseBtn = document.getElementById('pauseBtn');
            if (isRunning) {
                isRunning = false;
                pauseBtn.textContent = '‚ñ∂Ô∏è Reanudar';
                pauseBtn.style.background = '#4CAF50';
            } else {
                isRunning = true;
                pauseBtn.textContent = '‚è∏Ô∏è Pausar';
                pauseBtn.style.background = '#FF9800';
                animate(); // Reiniciar el loop de animaci√≥n
            }
        };

        window.updateAnimationSpeed = function() {
            animationSpeed = parseFloat(document.getElementById('animationSpeed').value);
            document.getElementById('animationSpeedValue').textContent = animationSpeed.toFixed(1) + 'x';
        };

        window.loadConfiguration = function() {
            if (!engine) return;

            const savedConfig = localStorage.getItem('simulationConfig');
            if (!savedConfig) {
                alert('No hay configuraci√≥n guardada');
                return;
            }

            try {
                const config = JSON.parse(savedConfig);

                // Cargar todos los valores de configuraci√≥n
                document.getElementById('nuclearForce').value = config.nuclearForce || 25;
                document.getElementById('nuclearRange').value = config.nuclearRange || 40;
                document.getElementById('nuclearAttractive').value = config.nuclearAttractive || 30;
                document.getElementById('nuclearDamping').value = config.nuclearDamping || 0.7;
                document.getElementById('protonRepulsion').value = config.protonRepulsion || 15;
                document.getElementById('coulombForce').value = config.coulombForce || 3;
                document.getElementById('orbitalSpeed').value = config.orbitalSpeed || 8;
                document.getElementById('orbitalRadius').value = config.orbitalRadius || 100;
                document.getElementById('electronRepulsion').value = config.electronRepulsion || 2;
                document.getElementById('nuclearMass').value = config.nuclearMass || 3;
                document.getElementById('electronMass').value = config.electronMass || 0.01;
                document.getElementById('electronDamping').value = config.electronDamping || 0.999;

                // Actualizar display para todos los par√°metros
                updateParam('nuclear_force');
                updateParam('nuclear_range');
                updateParam('nuclear_attractive');
                updateParam('nuclear_damping');
                updateParam('proton_repulsion');
                updateParam('coulomb_force');
                updateParam('orbital_speed');
                updateParam('orbital_radius');
                updateParam('electron_repulsion');
                updateParam('nuclear_mass');
                updateParam('electron_mass');
                updateParam('electron_damping');

                alert('Configuraci√≥n cargada exitosamente');
            } catch (error) {
                alert('Error al cargar la configuraci√≥n');
            }
        };

        // Tabla peri√≥dica extendida
        const periodicTable = {
            1: { symbol: 'H', name: 'Hidr√≥geno', period: 1, group: 1, color: '#ff9999' },
            2: { symbol: 'He', name: 'Helio', period: 1, group: 18, color: '#ffcc99' },
            3: { symbol: 'Li', name: 'Litio', period: 2, group: 1, color: '#ff99cc' },
            4: { symbol: 'Be', name: 'Berilio', period: 2, group: 2, color: '#cc99ff' },
            5: { symbol: 'B', name: 'Boro', period: 2, group: 13, color: '#99ffcc' },
            6: { symbol: 'C', name: 'Carbono', period: 2, group: 14, color: '#99ccff' },
            7: { symbol: 'N', name: 'Nitr√≥geno', period: 2, group: 15, color: '#ffff99' },
            8: { symbol: 'O', name: 'Ox√≠geno', period: 2, group: 16, color: '#ff9966' },
            9: { symbol: 'F', name: 'Fl√∫or', period: 2, group: 17, color: '#99ff99' },
            10: { symbol: 'Ne', name: 'Ne√≥n', period: 2, group: 18, color: '#ff99ff' },
            11: { symbol: 'Na', name: 'Sodio', period: 3, group: 1, color: '#9999ff' },
            12: { symbol: 'Mg', name: 'Magnesio', period: 3, group: 2, color: '#ffcc66' },
            13: { symbol: 'Al', name: 'Aluminio', period: 3, group: 13, color: '#cc99cc' },
            14: { symbol: 'Si', name: 'Silicio', period: 3, group: 14, color: '#99ffff' },
            15: { symbol: 'P', name: 'F√≥sforo', period: 3, group: 15, color: '#ffff66' },
            16: { symbol: 'S', name: 'Azufre', period: 3, group: 16, color: '#ff6666' },
            17: { symbol: 'Cl', name: 'Cloro', period: 3, group: 17, color: '#66ff66' },
            18: { symbol: 'Ar', name: 'Arg√≥n', period: 3, group: 18, color: '#ff66ff' },
            19: { symbol: 'K', name: 'Potasio', period: 4, group: 1, color: '#6666ff' },
            20: { symbol: 'Ca', name: 'Calcio', period: 4, group: 2, color: '#ffcc33' },
            21: { symbol: 'Sc', name: 'Escandio', period: 4, group: 3, color: '#cccccc' },
            22: { symbol: 'Ti', name: 'Titanio', period: 4, group: 4, color: '#cccccc' },
            23: { symbol: 'V', name: 'Vanadio', period: 4, group: 5, color: '#cccccc' },
            24: { symbol: 'Cr', name: 'Cromo', period: 4, group: 6, color: '#cccccc' },
            25: { symbol: 'Mn', name: 'Manganeso', period: 4, group: 7, color: '#cccccc' },
            26: { symbol: 'Fe', name: 'Hierro', period: 4, group: 8, color: '#cccccc' },
            27: { symbol: 'Co', name: 'Cobalto', period: 4, group: 9, color: '#cccccc' },
            28: { symbol: 'Ni', name: 'N√≠quel', period: 4, group: 10, color: '#cccccc' },
            29: { symbol: 'Cu', name: 'Cobre', period: 4, group: 11, color: '#cccccc' },
            30: { symbol: 'Zn', name: 'Zinc', period: 4, group: 12, color: '#cccccc' },
            31: { symbol: 'Ga', name: 'Galio', period: 4, group: 13, color: '#cccccc' },
            32: { symbol: 'Ge', name: 'Germanio', period: 4, group: 14, color: '#cccccc' },
            33: { symbol: 'As', name: 'Ars√©nico', period: 4, group: 15, color: '#cccccc' },
            34: { symbol: 'Se', name: 'Selenio', period: 4, group: 16, color: '#cccccc' },
            35: { symbol: 'Br', name: 'Bromo', period: 4, group: 17, color: '#cccccc' },
            36: { symbol: 'Kr', name: 'Kript√≥n', period: 4, group: 18, color: '#cccccc' },
            37: { symbol: 'Rb', name: 'Rubidio', period: 5, group: 1, color: '#6666cc' },
            38: { symbol: 'Sr', name: 'Estroncio', period: 5, group: 2, color: '#ffcc00' },
            39: { symbol: 'Y', name: 'Itrio', period: 5, group: 3, color: '#cccccc' },
            40: { symbol: 'Zr', name: 'Circonio', period: 5, group: 4, color: '#cccccc' },
            41: { symbol: 'Nb', name: 'Niobio', period: 5, group: 5, color: '#cccccc' },
            42: { symbol: 'Mo', name: 'Molibdeno', period: 5, group: 6, color: '#cccccc' },
            43: { symbol: 'Tc', name: 'Tecnecio', period: 5, group: 7, color: '#cccccc' },
            44: { symbol: 'Ru', name: 'Rutenio', period: 5, group: 8, color: '#cccccc' },
            45: { symbol: 'Rh', name: 'Rodio', period: 5, group: 9, color: '#cccccc' },
            46: { symbol: 'Pd', name: 'Paladio', period: 5, group: 10, color: '#cccccc' },
            47: { symbol: 'Ag', name: 'Plata', period: 5, group: 11, color: '#cccccc' },
            48: { symbol: 'Cd', name: 'Cadmio', period: 5, group: 12, color: '#cccccc' },
            49: { symbol: 'In', name: 'Indio', period: 5, group: 13, color: '#cccccc' },
            50: { symbol: 'Sn', name: 'Esta√±o', period: 5, group: 14, color: '#cccccc' },
            51: { symbol: 'Sb', name: 'Antimonio', period: 5, group: 15, color: '#cccccc' },
            52: { symbol: 'Te', name: 'Telurio', period: 5, group: 16, color: '#cccccc' },
            53: { symbol: 'I', name: 'Yodo', period: 5, group: 17, color: '#cccccc' },
            54: { symbol: 'Xe', name: 'Xen√≥n', period: 5, group: 18, color: '#cccccc' },
            55: { symbol: 'Cs', name: 'Cesio', period: 6, group: 1, color: '#6666cc' },
            56: { symbol: 'Ba', name: 'Bario', period: 6, group: 2, color: '#ffcc00' },
            57: { symbol: 'La', name: 'Lantano', period: 6, group: 3, color: '#cccccc' },
            58: { symbol: 'Ce', name: 'Cerio', period: 6, group: 4, color: '#cccccc' },
            59: { symbol: 'Pr', name: 'Praseodimio', period: 6, group: 5, color: '#cccccc' },
            60: { symbol: 'Nd', name: 'Neodimio', period: 6, group: 6, color: '#cccccc' },
            61: { symbol: 'Pm', name: 'Prometio', period: 6, group: 7, color: '#cccccc' },
            62: { symbol: 'Sm', name: 'Samario', period: 6, group: 8, color: '#cccccc' },
            63: { symbol: 'Eu', name: 'Europio', period: 6, group: 9, color: '#cccccc' },
            64: { symbol: 'Gd', name: 'Gadolinio', period: 6, group: 10, color: '#cccccc' },
            65: { symbol: 'Tb', name: 'Terbio', period: 6, group: 11, color: '#cccccc' },
            66: { symbol: 'Dy', name: 'Disprosio', period: 6, group: 12, color: '#cccccc' },
            67: { symbol: 'Ho', name: 'Holmio', period: 6, group: 13, color: '#cccccc' },
            68: { symbol: 'Er', name: 'Erbio', period: 6, group: 14, color: '#cccccc' },
            69: { symbol: 'Tm', name: 'Tulio', period: 6, group: 15, color: '#cccccc' },
            70: { symbol: 'Yb', name: 'Iterbio', period: 6, group: 16, color: '#cccccc' },
            71: { symbol: 'Lu', name: 'Lutecio', period: 6, group: 17, color: '#cccccc' },
            72: { symbol: 'Hf', name: 'Hafnio', period: 6, group: 4, color: '#cccccc' },
            73: { symbol: 'Ta', name: 'T√°ntalo', period: 6, group: 5, color: '#cccccc' },
            74: { symbol: 'W', name: 'Wolframio', period: 6, group: 6, color: '#cccccc' },
            75: { symbol: 'Re', name: 'Renio', period: 6, group: 7, color: '#cccccc' },
            76: { symbol: 'Os', name: 'Osmio', period: 6, group: 8, color: '#cccccc' },
            77: { symbol: 'Ir', name: 'Iridio', period: 6, group: 9, color: '#cccccc' },
            78: { symbol: 'Pt', name: 'Platino', period: 6, group: 10, color: '#cccccc' },
            79: { symbol: 'Au', name: 'Oro', period: 6, group: 11, color: '#cccccc' },
            80: { symbol: 'Hg', name: 'Mercurio', period: 6, group: 12, color: '#cccccc' },
            81: { symbol: 'Tl', name: 'Talio', period: 6, group: 13, color: '#cccccc' },
            82: { symbol: 'Pb', name: 'Plomo', period: 6, group: 14, color: '#cccccc' },
            83: { symbol: 'Bi', name: 'Bismuto', period: 6, group: 15, color: '#cccccc' },
            84: { symbol: 'Po', name: 'Polonio', period: 6, group: 16, color: '#cccccc' },
            85: { symbol: 'At', name: 'Astato', period: 6, group: 17, color: '#cccccc' },
            86: { symbol: 'Rn', name: 'Rad√≥n', period: 6, group: 18, color: '#cccccc' },
            87: { symbol: 'Fr', name: 'Francio', period: 7, group: 1, color: '#6666cc' },
            88: { symbol: 'Ra', name: 'Radio', period: 7, group: 2, color: '#ffcc00' },
            89: { symbol: 'Ac', name: 'Actinio', period: 7, group: 3, color: '#cccccc' },
            90: { symbol: 'Th', name: 'Torio', period: 7, group: 4, color: '#cccccc' },
            91: { symbol: 'Pa', name: 'Protactinio', period: 7, group: 5, color: '#cccccc' },
            92: { symbol: 'U', name: 'Uranio', period: 7, group: 6, color: '#cccccc' },
            93: { symbol: 'Np', name: 'Neptunio', period: 7, group: 7, color: '#cccccc' },
            94: { symbol: 'Pu', name: 'Plutonio', period: 7, group: 8, color: '#cccccc' },
            95: { symbol: 'Am', name: 'Americio', period: 7, group: 9, color: '#cccccc' },
            96: { symbol: 'Cm', name: 'Curio', period: 7, group: 10, color: '#cccccc' },
            97: { symbol: 'Bk', name: 'Berkelio', period: 7, group: 11, color: '#cccccc' },
            98: { symbol: 'Cf', name: 'Californio', period: 7, group: 12, color: '#cccccc' },
            99: { symbol: 'Es', name: 'Einstenio', period: 7, group: 13, color: '#cccccc' },
            100: { symbol: 'Fm', name: 'Fermio', period: 7, group: 14, color: '#cccccc' },
            101: { symbol: 'Md', name: 'Mendelevio', period: 7, group: 15, color: '#cccccc' },
            102: { symbol: 'No', name: 'Nobelio', period: 7, group: 16, color: '#cccccc' },
            103: { symbol: 'Lr', name: 'Laurencio', period: 7, group: 17, color: '#cccccc' },
            104: { symbol: 'Rf', name: 'Rutherfordio', period: 7, group: 4, color: '#cccccc' },
            105: { symbol: 'Db', name: 'Dubnio', period: 7, group: 5, color: '#cccccc' },
            106: { symbol: 'Sg', name: 'Seaborgio', period: 7, group: 6, color: '#cccccc' },
            107: { symbol: 'Bh', name: 'Bohrio', period: 7, group: 7, color: '#cccccc' },
            108: { symbol: 'Hs', name: 'Hassio', period: 7, group: 8, color: '#cccccc' },
            109: { symbol: 'Mt', name: 'Meitnerio', period: 7, group: 9, color: '#cccccc' },
            110: { symbol: 'Ds', name: 'Darmstadtio', period: 7, group: 10, color: '#cccccc' },
            111: { symbol: 'Rg', name: 'Roentgenio', period: 7, group: 11, color: '#cccccc' },
            112: { symbol: 'Cn', name: 'Copernicio', period: 7, group: 12, color: '#cccccc' },
            113: { symbol: 'Nh', name: 'Nihonio', period: 7, group: 13, color: '#cccccc' },
            114: { symbol: 'Fl', name: 'Flerovio', period: 7, group: 14, color: '#cccccc' },
            115: { symbol: 'Mc', name: 'Moscovio', period: 7, group: 15, color: '#cccccc' },
            116: { symbol: 'Lv', name: 'Livermorio', period: 7, group: 16, color: '#cccccc' },
            117: { symbol: 'Ts', name: 'Tenesino', period: 7, group: 17, color: '#cccccc' },
            118: { symbol: 'Og', name: 'Oganes√≥n', period: 7, group: 18, color: '#cccccc' }
        };

        // Generar tabla peri√≥dica
        function generatePeriodicTable() {
            console.log('Iniciando generatePeriodicTable()');
            const container = document.getElementById('periodicTableContainer');
            console.log('Container:', container);
            if (!container) {
                console.error('No se encontr√≥ el container periodicTableContainer');
                return;
            }

            // Crear grid principal de 9 periodos x 18 grupos
            const grid = Array(10).fill(null).map(() => Array(18).fill(null));

            // Ubicar elementos en el grid con posiciones correctas de la tabla peri√≥dica
            for (let [number, element] of Object.entries(periodicTable)) {
                const num = parseInt(number);
                let { period, group, symbol, color } = element;

                // Mantener posiciones originales para elementos principales
                // Los lant√°nidos y act√≠nidos ya est√°n definidos con sus posiciones correctas

                if (period <= 10 && group <= 18 && group > 0) {
                    grid[period - 1][group - 1] = { number: num, symbol, color, name: element.name };
                }
            }

            // Generar HTML
            let html = '';

            // Per√≠odos 1-7 (principales) - mantener la estructura original
            for (let period = 0; period < 7; period++) {
                for (let group = 0; group < 18; group++) {
                    const element = grid[period][group];
                    if (element) {
                        const elementData = periodicTable[element.number];
                        const tooltip = `${element.number}: ${elementData.symbol} - ${elementData.name} (Per√≠odo ${elementData.period}, Grupo ${elementData.group})`;
                        html += `<button onclick="addElement(${element.number})" title="${tooltip}" style="background: ${element.color}; color: #000; border: 1px solid #555; font-size: 10px; font-weight: bold; padding: 4px 2px; margin: 0; min-width: 24px; height: 24px; cursor: pointer; border-radius: 3px; display: flex; align-items: center; justify-content: center;">${element.symbol}</button>`;
                    } else {
                        html += '<div style="background: #222; border: 1px solid #333; min-height: 24px;"></div>';
                    }
                }
            }

            // Fila de lant√°nidos (per√≠odo 6 - elementos 58-71)
            html += '<div style="grid-column: 1 / -1; display: grid; grid-template-columns: repeat(18, 1fr); gap: 2px; margin: 4px 0; border-top: 2px solid #555; padding-top: 8px;">';
            html += '<div style="background: #333; color: #fff; font-size: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid #777;">Lant√°nidos (57-71)</div>';

            // Lant√°nidos: La(57), Ce(58), Pr(59), Nd(60), Pm(61), Sm(62), Eu(63), Gd(64), Tb(65), Dy(66), Ho(67), Er(68), Tm(69), Yb(70), Lu(71)
            const lanthanides = [57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71];
            for (let i = 0; i < 15; i++) {
                const elementNum = lanthanides[i];
                if (elementNum && periodicTable[elementNum]) {
                    const elementData = periodicTable[elementNum];
                    const tooltip = `${elementNum}: ${elementData.symbol} - ${elementData.name} (Lant√°nido)`;
                    html += `<button onclick="addElement(${elementNum})" title="${tooltip}" style="background: ${elementData.color}; color: #000; border: 1px solid #555; font-size: 9px; font-weight: bold; padding: 3px 1px; margin: 0; min-width: 22px; height: 22px; cursor: pointer; border-radius: 3px; display: flex; align-items: center; justify-content: center;">${elementData.symbol}</button>`;
                } else {
                    html += '<div style="background: #222; border: 1px solid #333; min-height: 22px;"></div>';
                }
            }
            html += '<div style="background: #222; border: 1px solid #333;"></div>';
            html += '<div style="background: #222; border: 1px solid #333;"></div>';
            html += '</div>';

            // Fila de act√≠nidos (per√≠odo 7 - elementos 89-103 y elementos pesados 104-118)
            html += '<div style="grid-column: 1 / -1; display: grid; grid-template-columns: repeat(18, 1fr); gap: 2px; margin: 4px 0;">';
            html += '<div style="background: #333; color: #fff; font-size: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold;">Act√≠nidos</div>';

            // Act√≠nidos: Ac(89), Th(90), Pa(91), U(92), Np(93), Pu(94), Am(95), Cm(96), Bk(97), Cf(98), Es(99), Fm(100), Md(101), No(102), Lr(103)
            // Elementos pesados: Rf(104), Db(105), Sg(106), Bh(107), Hs(108), Mt(109), Ds(110), Rg(111), Cn(112), Nh(113), Fl(114), Mc(115), Lv(116), Ts(117), Og(118)
            const actinidesAndHeavy = [89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118];

            for (let i = 0; i < 18; i++) {
                const elementNum = actinidesAndHeavy[i];
                if (elementNum && periodicTable[elementNum]) {
                    const elementData = periodicTable[elementNum];
                    const elementType = elementNum >= 89 && elementNum <= 103 ? 'Act√≠nido' : 'Elemento pesado';
                    const tooltip = `${elementNum}: ${elementData.symbol} - ${elementData.name} (${elementType})`;
                    html += `<button onclick="addElement(${elementNum})" title="${tooltip}" style="background: ${elementData.color}; color: #000; border: 1px solid #555; font-size: 8px; font-weight: bold; padding: 2px 1px; margin: 0; min-width: 20px; height: 20px; cursor: pointer; border-radius: 3px; display: flex; align-items: center; justify-content: center;">${elementData.symbol}</button>`;
                } else {
                    html += '<div style="background: #222; border: 1px solid #333; min-height: 20px;"></div>';
                }
            }
            html += '</div>';

            console.log('HTML generado:', html);
            container.innerHTML = html;
            console.log('Tabla peri√≥dica completa insertada en el DOM');
        }

        window.addEventListener('load', () => {
            initWasm();
        });
    </script>
</head>
<body>
    <div class="controls">
        <div class="controls-section">
            <h3>Part√≠culas</h3>
            <button class="particle-btn" onclick="addSingleParticle(0)">+ Prot√≥n</button>
            <button class="particle-btn" onclick="addSingleParticle(1)">+ Neutr√≥n</button>
            <button class="particle-btn" onclick="addSingleParticle(2)">+ Electr√≥n</button>
        </div>

        <div class="controls-section">
            <h3>Iones del Hidr√≥geno</h3>
            <button class="particle-btn" onclick="addHydrogenIons()">H‚Å∫, H, H‚Åª</button>
            <button class="particle-btn" onclick="addElementAtom(1, 1)">H‚Å∫ (Prot√≥n)</button>
            <button class="particle-btn" onclick="addElementAtom(1, 0)">H (Neutro)</button>
            <button class="particle-btn" onclick="addElementAtom(1, -1)">H‚Åª (Hidruro)</button>
        </div>

        <div class="controls-section">
            <h3>Colisiones</h3>
            <button class="particle-btn" onclick="addCollisionPair(0, 0)">‚ö° Prot√≥n-Prot√≥n</button>
            <button class="particle-btn" onclick="addCollisionPair(1, 1)">‚ö° Neutr√≥n-Neutr√≥n</button>
            <button class="particle-btn" onclick="addCollisionPair(2, 2)">‚ö° Electr√≥n-Electr√≥n</button>
            <button class="particle-btn" onclick="addCollisionPair(0, 1)">‚ö° Prot√≥n-Neutr√≥n</button>
            <button class="particle-btn" onclick="addCollisionPair(2, 1)">‚ö° Electr√≥n-Neutr√≥n</button>
            <button class="particle-btn" onclick="addCollisionPair(0, 2)">‚ö° Prot√≥n-Electr√≥n</button>
        </div>

        <div class="controls-section">
            <h3>Simulaci√≥n</h3>
            <button id="pauseBtn" onclick="togglePause()" style="background: #FF9800; font-size: 10px; padding: 4px 6px;">‚è∏Ô∏è Pausar</button>
            <button onclick="saveConfiguration()" style="background: #2196F3; font-size: 10px; padding: 4px 6px;">üíæ Guardar</button>
            <button onclick="loadConfiguration()" style="background: #9C27B0; font-size: 10px; padding: 4px 6px;">üìÇ Cargar</button>
            <button onclick="resetToDefaults()" style="background: #FF9800; font-size: 10px; padding: 4px 6px;">üîÑ Reset</button>
            <button class="clear-btn" onclick="clearCanvas()">üóëÔ∏è Limpiar</button>
        </div>

        
        <div class="controls-section" style="min-width: 700px; max-width: 800px;">
            <h3>Tabla Peri√≥dica Completa (118 elementos)</h3>
            <div id="periodicTableContainer" style="display: grid; grid-template-columns: repeat(18, 1fr); gap: 2px; font-size: 8px; background: #333; padding: 4px; border-radius: 6px; overflow: auto; height: 280px; border: 2px solid #555;">
                <!-- La tabla se generar√° con JavaScript -->
            </div>
        </div>

        <div class="controls-section">
            <h3>Velocidad</h3>
            <div class="control-group">
                <label>Velocidad Animaci√≥n: <span class="value-display" id="animationSpeedValue">1.0x</span></label>
                <input type="range" id="animationSpeed" min="0.1" max="20.0" value="1" step="0.1" oninput="updateAnimationSpeed()">
                <div style="font-size: 10px; color: #888; margin-top: 4px;">
                    0.1 = Muy lento | 1.0 = Normal | 20.0 = M√°ximo FPS
                </div>
            </div>
            <div class="control-group" style="margin-top: 10px;">
                <label>FPS Actuales: <span class="value-display" id="fpsDisplay">0</span></label>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="controls-sidebar">
            <h3>Controles</h3>

            <div class="controls-section">
                <h4>Fuerzas Nucleares</h4>
                <div class="control-group">
                    <label>Fuerza Nuclear Fuerte: <span class="value-display" id="nuclearForceValue">25.0</span></label>
                    <input type="range" id="nuclearForce" min="0" max="50" value="25" step="0.5" oninput="updateParam('nuclear_force')">
                </div>
                <div class="control-group">
                    <label>Rango Nuclear: <span class="value-display" id="nuclearRangeValue">40</span></label>
                    <input type="range" id="nuclearRange" min="20" max="150" value="40" step="1" oninput="updateParam('nuclear_range')">
                </div>
                <div class="control-group">
                    <label>Fuerza Atractiva: <span class="value-display" id="nuclearAttractiveValue">30.0</span></label>
                    <input type="range" id="nuclearAttractive" min="0" max="50" value="30" step="0.5" oninput="updateParam('nuclear_attractive')">
                </div>
                <div class="control-group">
                    <label>Amortiguaci√≥n Nuclear: <span class="value-display" id="nuclearDampingValue">0.7</span></label>
                    <input type="range" id="nuclearDamping" min="0" max="1" value="0.7" step="0.01" oninput="updateParam('nuclear_damping')">
                </div>
            </div>

            <div class="controls-section">
                <h4>Prot√≥n-Prot√≥n</h4>
                <div class="control-group">
                    <label>Repulsi√≥n: <span class="value-display" id="protonRepulsionValue">15.0</span></label>
                    <input type="range" id="protonRepulsion" min="0" max="30" value="15" step="0.5" oninput="updateParam('proton_repulsion')">
                </div>
            </div>

            <div class="controls-section">
                <h4>Electr√≥n-Prot√≥n</h4>
                <div class="control-group">
                    <label>Fuerza Coulomb: <span class="value-display" id="coulombForceValue">3.0</span></label>
                    <input type="range" id="coulombForce" min="0" max="10" value="3" step="0.1" oninput="updateParam('coulomb_force')">
                </div>
                <div class="control-group">
                    <label>Velocidad Orbital: <span class="value-display" id="orbitalSpeedValue">8.0</span></label>
                    <input type="range" id="orbitalSpeed" min="0" max="20" value="8" step="0.5" oninput="updateParam('orbital_speed')">
                </div>
                <div class="control-group">
                    <label>Radio Orbital: <span class="value-display" id="orbitalRadiusValue">100</span></label>
                    <input type="range" id="orbitalRadius" min="20" max="300" value="100" step="5" oninput="updateParam('orbital_radius')">
                </div>
            </div>

            <div class="controls-section">
                <h4>Electr√≥n-Electr√≥n</h4>
                <div class="control-group">
                    <label>Repulsi√≥n: <span class="value-display" id="electronRepulsionValue">2.0</span></label>
                    <input type="range" id="electronRepulsion" min="0" max="5" value="2" step="0.1" oninput="updateParam('electron_repulsion')">
                </div>
            </div>

            <div class="controls-section">
                <h4>Masas y Amortiguaci√≥n</h4>
                <div class="control-group">
                    <label>Masa Nuclear: <span class="value-display" id="nuclearMassValue">3.0</span></label>
                    <input type="range" id="nuclearMass" min="1" max="10" value="3" step="0.5" oninput="updateParam('nuclear_mass')">
                </div>
                <div class="control-group">
                    <label>Masa Electr√≥n: <span class="value-display" id="electronMassValue">0.01</span></label>
                    <input type="range" id="electronMass" min="0.001" max="0.1" value="0.01" step="0.001" oninput="updateParam('electron_mass')">
                </div>
                <div class="control-group">
                    <label>Amortiguaci√≥n Electr√≥n: <span class="value-display" id="electronDampingValue">0.999</span></label>
                    <input type="range" id="electronDamping" min="0.9" max="1" value="0.999" step="0.001" oninput="updateParam('electron_damping')">
                </div>
            </div>


        </div>

        <div class="canvas-wrapper">
            <canvas id="particleCanvas" style="width: 100%; height: 100%;"></canvas>
        </div>

        <div class="info-sidebar">
            <div class="color-legend">
        <h3>Leyenda de Subniveles</h3>
        <div class="legend-section">
            <h4>üî¨ Subniveles Orbitales</h4>
            <div class="legend-items">
                <div class="legend-item">
                    <span class="color-box" style="background: #ff9800;"></span>
                    <span>1s - Orbital esf√©rico</span>
                </div>
                <div class="legend-item">
                    <span class="color-box" style="background: #ffff00;"></span>
                    <span>2s - Orbital esf√©rico</span>
                </div>
                <div class="legend-item">
                    <span class="color-box" style="background: #4caf50;"></span>
                    <span>2p - Orbital en forma de 8</span>
                </div>
                <div class="legend-item">
                    <span class="color-box" style="background: #9c27b0;"></span>
                    <span>3s - Orbital esf√©rico</span>
                </div>
                <div class="legend-item">
                    <span class="color-box" style="background: #2196f3;"></span>
                    <span>3p - Orbital en forma de 8</span>
                </div>
                <div class="legend-item">
                    <span class="color-box" style="background: #ff5722;"></span>
                    <span>4s - Orbital esf√©rico</span>
                </div>
                <div class="legend-item">
                    <span class="color-box" style="background: #8e24aa;"></span>
                    <span>3d - Orbital de tr√©bol</span>
                </div>
                <div class="legend-item">
                    <span class="color-box" style="background: #00bcd4;"></span>
                    <span>4f - Orbital complejo</span>
                </div>
            </div>
        </div>
        <div class="legend-section">
            <h4>‚öõÔ∏è Part√≠culas</h4>
            <div class="legend-items">
                <div class="legend-item">
                    <span class="color-box" style="background: rgba(255, 0, 0, 0.05); border: 1px solid #ff0000;"></span>
                    <span>Prot√≥n (5% visible)</span>
                </div>
                <div class="legend-item">
                    <span class="color-box" style="background: rgba(255, 255, 255, 0.05); border: 1px solid #ffffff;"></span>
                    <span>Neutr√≥n (5% visible)</span>
                </div>
            </div>
        </div>
            </div>

            <div class="element-info">
                <h3>Estado Actual</h3>
                <div>Part√≠culas:
                    <ul>
                        <li>Protones: <strong id="protonCount">0</strong></li>
                        <li>Neutrones: <strong id="neutronCount">0</strong></li>
                        <li>Electrones: <strong id="electronCount">0</strong></li>
                    </ul>
                </div>
                <div>√Åtomos Detectados:
                    <div id="nucleiList"></div>
                </div>
                <div>Total de √Åtomos: <strong id="nucleiCount">0</strong></div>
            </div>
        </div>
    </div>

</body>
</html>
